<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>달의 모양 관찰하기</title>
    <style>
        /* 이전 스타일은 유지하고 새로운 스타일 추가 */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        /* ... (이전 스타일 유지) ... */
        
        /* 새로운 스타일 */
        .astro-info {
            background: #f0f8ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .astro-info h3 {
            color: #2c5282;
            margin-top: 0;
        }
        .time-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }
        .time-card {
            background: white;
            padding: 10px;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .highlight {
            color: #2c5282;
            font-weight: bold;
        }
        .location-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 8px;
            background: #e2e8f0;
            border-radius: 4px;
        }
        .events-list {
            margin-top: 15px;
            padding: 10px;
            background: white;
            border-radius: 6px;
        }
        .event-item {
            margin: 8px 0;
            padding: 8px;
            background: #f7fafc;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <!-- 기존 HTML 구조 유지 -->
    <div class="container">
        <!-- ... (기존 헤더와 컨트롤) ... -->

        <!-- 천문 정보 섹션 추가 -->
        <div class="astro-info">
            <div class="location-info">
                <div id="locationStatus">위치 정보 가져오는 중...</div>
            </div>
            
            <div class="time-info">
                <div class="time-card">
                    <h3>달 출몰 시각</h3>
                    <div id="moonTimes"></div>
                </div>
                <div class="time-card">
                    <h3>관측 가능 시간</h3>
                    <div id="observationTime"></div>
                </div>
            </div>

            <div class="events-list">
                <h3>다가오는 천문 현상</h3>
                <div id="upcomingEvents"></div>
            </div>
        </div>

        <!-- ... (기존 달 표시 섹션) ... -->
    </div>

    <script>
        // 기존 JavaScript 코드 유지
        
        // 새로운 천문 계산 함수들 추가
        function calculateMoonTimes(date, lat, lon) {
            // 실제로는 더 복잡한 천문 계산이 필요합니다
            // 여기서는 간단한 예시로 구현
            const sunrise = new Date(date);
            sunrise.setHours(6, 0, 0);
            const sunset = new Date(date);
            sunset.setHours(18, 0, 0);
            
            return {
                moonrise: sunrise,
                moonset: sunset,
                optimal: "20:00 - 22:00"
            };
        }

        function getNextFullMoon(currentDate) {
            // 다음 보름달 날짜 계산 (간단한 근사치)
            const currentPhase = getMoonPhase(currentDate);
            const daysUntilFull = (50 - currentPhase) / (100/29.5);
            const nextFull = new Date(currentDate);
            nextFull.setDate(nextFull.getDate() + Math.ceil(daysUntilFull));
            return nextFull;
        }

        function getNextLunarEclipse() {
            // 다음 월식 날짜 (실제 데이터는 천문 API나 데이터베이스 필요)
            return new Date("2024-09-18");
        }

        // 위치 정보 및 천문 정보 업데이트
        function updateAstronomicalInfo(position) {
            const { latitude, longitude } = position.coords;
            const locationStatus = document.getElementById('locationStatus');
            locationStatus.textContent = `현재 위치: 위도 ${latitude.toFixed(2)}°, 경도 ${longitude.toFixed(2)}°`;

            const today = new Date();
            const moonTimes = calculateMoonTimes(today, latitude, longitude);
            
            const moonTimesDiv = document.getElementById('moonTimes');
            moonTimesDiv.innerHTML = `
                달 출: ${moonTimes.moonrise.toLocaleTimeString('ko-KR')}
                <br>
                달 몰: ${moonTimes.moonset.toLocaleTimeString('ko-KR')}
            `;

            const observationTimeDiv = document.getElementById('observationTime');
            observationTimeDiv.innerHTML = `
                최적 관측 시간: ${moonTimes.optimal}
            `;

            const nextFullMoon = getNextFullMoon(today);
            const nextEclipse = getNextLunarEclipse();

            const upcomingEventsDiv = document.getElementById('upcomingEvents');
            upcomingEventsDiv.innerHTML = `
                <div class="event-item">
                    다음 보름달: ${nextFullMoon.toLocaleDateString('ko-KR')}
                </div>
                <div class="event-item">
                    다음 월식: ${nextEclipse.toLocaleDateString('ko-KR')}
                </div>
            `;
        }

        // 위치 정보 요청
        function requestLocation() {
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(
                    updateAstronomicalInfo,
                    (error) => {
                        const locationStatus = document.getElementById('locationStatus');
                        locationStatus.textContent = "위치 정보를 가져올 수 없습니다. 기본 값으로 표시됩니다.";
                        // 서울 기준으로 기본 정보 표시
                        updateAstronomicalInfo({
                            coords: {
                                latitude: 37.5665,
                                longitude: 126.9780
                            }
                        });
                    }
                );
            } else {
                const locationStatus = document.getElementById('locationStatus');
                locationStatus.textContent = "위치 정보가 지원되지 않는 브라우저입니다.";
            }
        }

        // 페이지 로드 시 위치 정보 요청
        requestLocation();

        // 이전 이벤트 리스너들 유지
    </script>
</body>
</html>
